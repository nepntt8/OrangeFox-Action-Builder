    - name: "Building OrangeFox"
      run: |
        cd ${GITHUB_WORKSPACE}/OrangeFox/fox_${{ inputs.MANIFEST_BRANCH }}
        source build/envsetup.sh
        
        # ALL 70+ OrangeFox Flags - DIRECT EXPORT
        export FOX_AB_DEVICE=0
        export FOX_USE_BASH_SHELL=1
        export FOX_USE_TWRP_RECOVERY_IMAGE_BUILDER=1
        export FOX_VIRTUAL_AB_DEVICE=0
        export FOX_VARIANT=samsung
        export FOX_RECOVERY_VARIANT=samsung
        export FOX_NO_SAMSUNG_SPECIAL=1
        export FOX_PARTITION_SIZE_128GB=1
        export FOX_LARGE_FILE_SUPPORT=1
        export FOX_RECOVERY_SDCARD_ON_DATA=1
        export OF_PATCH_AVB20=1
        export OF_SUPPORT_AV20=1
        export OF_SUPPORT_VBMETA_AVB2_PATCHING=1
        export FOX_USE_MAGISKBOOT=1
        export OF_SAMSUNG_SEANDROIDENFORCE=1
        export FOX_SAMSUNG_0_BINARY_REPACK_NO_VBMETA_FLAG=1
        export OF_DYNAMIC_SAMSUNG_FIX=1
        export FOX_SAMSUNG_DYNAMIC_SLOT_NO_REPLACE=1
        export FOX_CRB_TOOL_SUPPORT=1
        export FOX_USE_CRB_PARTITION_MANAGER=1
        export OF_CRB_SYSTEM_RW_CONVERSION=1
        export FOX_CRB_ROM_EXTRACTOR=1
        export OF_DISABLE_DM_VERITY_FORCED_ENCRYPTION=1
        export FOX_REPLACE_ENCRYPTION_FLAG=1
        export FOX_BUGGED_AOSP_ARB_WORKAROUND=1
        export FOX_FORCE_WIPE_SYSTEM_ON_FORMAT=1
        export FOX_ENABLE_GSI_RESIZE=1
        export FOX_RESIZE_SYSTEM_PARTITION=1
        export FOX_GSI_RESIZE_SYSTEM_DYNAMIC=1
        export FOX_USE_RESIZE2FS=1
        export FOX_GSI_PARTITION_AUTO_EXPAND=1
        export FOX_DYNAMIC_PARTITIONS_SUPPORT=1
        export FOX_SUPER_PARTITION_GSI=1
        export FOX_SAMSUNG_DYNAMIC_SUPER_GSI=1
        export FOX_GSI_SYSTEM_DYNAMIC_RESIZE=1
        export FOX_DISABLE_MIUI_OPTIMIZATION=1
        export FOX_MIUI_SYSTEM_ADS_DISABLED=1
        export FOX_NO_MIUI_SPECIAL_FEATURES=1
        export FOX_DISABLE_MIUI_GETAPPS=1
        export FOX_MIUI_LIGHT_MODE_DISABLED=1
        export FOX_NO_MIUI_AUTHORIZATION=1
        export FOX_DISABLE_GPLAY=1
        export OF_DONT_PATCH_ON_FRESH_INSTALLATION=0
        export FOX_USE_LZ4_BINARY=1
        export FOX_USE_NANO_EDITOR=1
        export FOX_USE_ZIP_BINARY=1
        export FOX_USE_ORANGEFOX_TOOLS=1
        export OF_SKIP_DECRYPTED_ADOPTED_STORAGE=1
        export FOX_USE_USERDATA_PARTITION=1
        export FOX_USE_MISC_PARTITION=1
        export FOX_USE_SYSTEM_PARTITION=1
        export OF_MAINTAINER=azwhikaru
        export OF_DEVICE=SM-M146B
        export OF_TARGET_DEVICE=m14x
        export ALLOW_MISSING_DEPENDENCIES=true
        export FOX_USE_SPECIFIC_MAGISK_ZIP=Magisk-v27.0.zip
        export FOX_DELETE_ARGS_LIST_AFTER_FORMATTING=1
        export FOX_WARNING_INSTALL_OUTSIDE_SDCARD=1
        export FOX_USE_TWRP_LPTOOLS=1
        export FOX_USE_SYSTEM_UI_RESET=1
        export FOX_USE_FBE_DECRYPTION_PARTITION=1
        export FOX_USE_FBE_DECRYPTION_AB=0
        export FOX_USE_FBE_DECRYPTION_SAMSUNG=1
        export FOX_USE_FBE_DECRYPTION_EXHM=1
        export FOX_USE_FBE_DECRYPTION_2STAGE=1
        export FOX_USE_FBE_DECRYPTION_VANILLA=1
        export FOX_USE_FBE_DECRYPTION_METADATA=1
        export FOX_USE_FBE_DECRYPTION_FILESYSTEM=1
        export FOX_USE_FBE_DECRYPTION_RAW=1
        export FOX_USE_FBE_DECRYPTION_HEADER=1
        export FOX_USE_FBE_DECRYPTION_KEYRING=1
        export FOX_USE_FBE_DECRYPTION_CRYPTFS=1
        export FOX_USE_FBE_DECRYPTION_TWRP=1
        export FOX_USE_FBE_DECRYPTION_SC=1
        export FOX_USE_FBE_DECRYPTION_TMO=1
        
        lunch twrp_${{ inputs.DEVICE_NAME }}-eng && make clean && mka adbd ${{ inputs.BUILD_TARGET }}image

    - name: "Set Release Properties"
      run: |
        echo "BUILD_DATE=$(TZ=Asia/Manila date +%Y%m%d)" >> $GITHUB_ENV
        cd ${GITHUB_WORKSPACE}/OrangeFox/fox_${{ inputs.MANIFEST_BRANCH }}
        DEVICE_TREE_URL="${{ inputs.DEVICE_TREE }}"
        if [[ "${DEVICE_TREE_URL}" == *.git ]]; then
          DEVICE_TREE_URL="${DEVICE_TREE_URL%.git}"
        fi
        echo "DEVICE_TREE_URL=${DEVICE_TREE_URL}" >> $GITHUB_ENV

    - name: "Upload to Release"
      uses: softprops/action-gh-release@v2
      with:
        files: |
          OrangeFox/fox_${{ inputs.MANIFEST_BRANCH }}/out/target/product/${{ inputs.DEVICE_NAME }}/OrangeFox*.img
          OrangeFox/fox_${{ inputs.MANIFEST_BRANCH }}/out/target/product/${{ inputs.DEVICE_NAME }}/OrangeFox*.zip
        name: "OrangeFox Recovery for ${{ inputs.DEVICE_NAME }} // ${{ env.BUILD_DATE }}"
        tag_name: ${{ github.run_id }}
        body: |
          ## OrangeFox Recovery Build - Unofficial
          Build: fox_${{ inputs.MANIFEST_BRANCH }}
          Device: [Device Tree/Branch](${{ env.DEVICE_TREE_URL }}/tree/${{ inputs.DEVICE_TREE_BRANCH }})
          Commit: [${{ env.COMMIT_ID }}](${{ env.DEVICE_TREE_URL }}/commit/${{ env.COMMIT_ID }})
          
          70+ FLAGS ENABLED:
          - OF_PATCH_AVB20=1 - AVB2.0
          - FOX_USE_MAGISKBOOT=1 - MagiskBoot
          - FOX_SAMSUNG_DYNAMIC_SUPER_GSI=1 - Samsung GSI
