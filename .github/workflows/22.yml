    - name: Building OrangeFox (NON-VANILLA + CRB + LPTOOLS 5.1 + GUI + GSI)
      run: |
        cd ${GITHUB_WORKSPACE}/OrangeFox/fox_${{ inputs.MANIFEST_BRANCH }}
        set +e
        source build/envsetup.sh
        export ALLOW_MISSING_DEPENDENCIES=true
        
        cd ${{ inputs.DEVICE_PATH }}
        echo "ðŸ”§ Creating PERFECT BoardConfig.mk..."
        
        # âœ… BACKUP & CLEAN
        cp BoardConfig.mk BoardConfig.mk.backup 2>/dev/null || true
        sed -i '/BOARD_MOVE_RECOVERY_RESOURCES_TO_VENDOR_BOOT/d' BoardConfig.mk
        
        # ðŸ”¥ ADD ALL FLAGS WITH echo (CORRECT SYNTAX)
        cat >> BoardConfig.mk << 'EOF'
# ========================================
# ðŸ”¥ ORANGEFOX NON-VANILLA FLAGS (CORRECT)
# ========================================

# Samsung Special
OF_SAMSUNG_SPECIAL:=1
BOARD_CUSTOM_BOOTIMG_MK:=true
OF_USE_SYSTEM_BOOTLOADER:=true
OF_SUPPORT_SAMSUNG_BOOT_MODE:=true
TW_INCLUDE_NTFS_3G:=true
TW_EXCLUDE_ENCRYPTED_BACKUPS:=true

# Core Features
FOX_USE_BASH_SHELL:=1
FOX_ASH_IS_BASH:=1
FOX_USE_NANO_EDITOR:=1
FOX_USE_TWRP_RECOVERY_IMAGE_BUILDER:=1
FOX_USE_TWRPB_BUILDER:=1

# Display
OF_USE_GREEN_LED:=0
FOX_WARNINGS_ARE_ERRORS:=0
TW_NO_SCREEN_BLANK:=true

# Boot & Partition
OF_PATCH_AVB20:=1
OF_SUPPORTS_DUAL_PARTITION:=1
OF_USE_MAGISKBOOT:=1
OF_USE_MAGISKBOOT_FOR_ALL_PATCHES:=1
OF_DONT_PATCH_ENCRYPTED_DEVICE:=1
OF_DONT_PATCH_ON_FRESH_INSTALL:=0
OF_DISABLE_MIUI_SPECIFIC_FEATURES:=1

# UI
FOX_DELETE_AROMAFM:=1
FOX_BUGGED_AOSP_ARB_WORKAROUND:=1
FOX_RESET_CACHE:=1
FOX_NO_DELETE_CRITICAL_PARTITIONS:=1
FOX_DISABLE_APP_MANAGER:=1

# Backup
OF_QUICK_BACKUP_LIST:="/data;"
OF_NO_BACKUP_NANDROID:=1
FOX_RECOVERY_AUTODECYP:=true
FOX_NO_DELETE_LOGICAL_PARTITIONS:=1

# Fingerprint
OF_USE_SYSTEM_FINGERPRINT_AS_DEFAULT:=1
BOARD_USES_METADATA_PARTITION:=true
BOARD_ROOT_EXTRA_FOLDERS+=metadata

# Maintainer
OF_MAINTAINER:=Unknown
TW_DEVICE_VERSION:=1.0

# Filesystem
BOARD_HAS_LARGE_FILESYSTEM:=true
TW_ALWAYS_RMRF:=true
TARGET_USERIMAGES_USE_EXT4:=true
TARGET_USERIMAGES_USE_F2FS:=true
TARGET_COPY_OUT_VENDOR:=vendor

# System Props
TW_OVERRIDE_SYSTEM_PROPS:="ro.build.product;ro.build.fingerprint=ro.system.build.fingerprint;ro.build.version.incremental;ro.product.device=ro.product.system.device;ro.product.model=ro.product.system.model;ro.product.name=ro.product.system.name"

# Advanced
FOX_ADVANCED_DD:=1
FOX_REPLACE_BUSYBOX_PS:=true
FOX_USE_BASH_SHELL_IN_BOX:=true

# ðŸ”¥ CRB TOOLS
FOX_ENABLE_CRTOOLS:=1
CRB_MAINTAINER:=Unknown
CRB_DEVICE:=M14X
FOX_CRTOOLS_VERSION:=1.0
CRB_SHOW_DEVICE_INFO:=1
CRB_ENABLE_PARTITION_INFO:=1
CRB_ENABLE_LOGGING:=1
CRB_ENABLE_PARTITION_MANAGER:=1

# ðŸ”¥ LP TOOLS 5.1
FOX_LPTOOLS:=1
FOX_LPTOOLS_VERSION:=5.1
FOX_LP_ENABLE_CACHE_WIPE:=1
FOX_LP_ENABLE_ADVANCED_LP:=1

# ðŸ”¥ GUI TOOLS
FOX_ENABLE_GUI_TOOLS:=1
FOX_GUI_TOOLS_VERSION:=1.0
FOX_GUI_PARTITION_MANAGER:=1
FOX_GUI_FILE_MANAGER:=1
FOX_GUI_LOG_VIEWER:=1

# ðŸ”¥ GSI SUPPORT
OF_SUPPORT_GSI:=1
FOX_USE_GSI_PATCHER:=1
FOX_GSI_VERSION:=1.0
OF_ENABLE_GSI:=true
TW_SUPPORT_GSI_PATCHING:=true

# Magisk
FOX_USE_SPECIFIC_MAGISK_ZIP:=https://raw.githubusercontent.com/OrangeFox/misc/master/tools/Magisk/Magisk.zip
EOF
        
        echo "âœ… BoardConfig.mk PERFECT! $(wc -l < BoardConfig.mk) lines"
        
        set -e
        cd ${GITHUB_WORKSPACE}/OrangeFox/fox_${{ inputs.MANIFEST_BRANCH }}
        lunch twrp_${{ inputs.DEVICE_NAME }}-eng
        make clean && time mka adbd ${{ inputs.BUILD_TARGET }}image
